import{_ as Q}from"./jNmtiVgl.js";import{H as z,G,k as O,c as d,a as t,b as J,w as K,m as i,v,x as C,t as s,y as h,F as N,r as _,d as A,j as I,g as u,A as x,C as W,o as l}from"./D8_npMnH.js";const X={class:"min-h-screen bg-gray-50 dark:bg-gray-900 py-8 px-4"},Y={class:"max-w-6xl mx-auto"},Z={class:"bg-white dark:bg-gray-800 shadow mb-8 -mx-4 px-4"},ee={class:"max-w-6xl mx-auto py-6 px-0"},te={class:"flex justify-between items-center"},re={class:"grid grid-cols-1 lg:grid-cols-3 gap-8"},ae={class:"lg:col-span-2"},oe={class:"bg-white dark:bg-gray-800 rounded-lg shadow p-6 mb-6"},de={class:"mb-6"},se={class:"flex gap-2 mb-2"},le=["disabled"],ne=["value"],ue={key:1,class:"mt-2 p-3 text-sm text-gray-600 dark:text-gray-400 bg-gray-50 dark:bg-gray-700 rounded-md border border-gray-300 dark:border-gray-600"},ie={key:2,class:"mt-2 p-3 text-sm text-gray-500 dark:text-gray-400 bg-gray-50 dark:bg-gray-700 rounded-md border border-dashed border-gray-300 dark:border-gray-600"},me={key:0,class:"space-y-4"},ye={class:"max-h-96 overflow-y-auto space-y-4 border border-gray-200 dark:border-gray-700 rounded-lg p-4 bg-gray-50 dark:bg-gray-700"},ge={class:"flex justify-between items-start mb-4"},ce={class:"font-semibold text-gray-900 dark:text-white"},be={class:"text-sm text-gray-600 dark:text-gray-400"},pe=["onClick"],ve={class:"grid grid-cols-3 gap-4"},xe=["onUpdate:modelValue","max"],ke={class:"mt-1 px-3 py-2 bg-gray-50 dark:bg-gray-700 rounded-md border border-gray-300 dark:border-gray-600 text-gray-900 dark:text-white font-semibold"},fe={class:"mt-1 px-3 py-2 bg-gray-50 dark:bg-gray-700 rounded-md border border-gray-300 dark:border-gray-600 text-gray-900 dark:text-white font-semibold"},we={key:1,class:"text-center py-8 bg-gray-50 dark:bg-gray-700 rounded-lg border border-dashed border-gray-300 dark:border-gray-600"},he={class:"bg-white dark:bg-gray-800 rounded-lg shadow p-6 mb-6"},Pe={class:"space-y-3 mb-6"},Se={class:"flex justify-between text-gray-700 dark:text-gray-300"},Ce={class:"font-semibold"},Ne={class:"flex justify-between text-gray-700 dark:text-gray-300"},_e={class:"font-semibold"},Ae={class:"border-t border-gray-200 dark:border-gray-700 pt-3 flex justify-between text-gray-900 dark:text-white font-bold text-lg"},Ie={class:"text-primary-600 dark:text-primary-400"},De={class:"space-y-4"},Ue=["value"],Ve=["max"],Te={class:"bg-gray-50 dark:bg-gray-700 p-3 rounded-md border border-gray-200 dark:border-gray-600"},Le={class:"text-sm text-gray-600 dark:text-gray-400"},qe={class:"font-semibold text-gray-900 dark:text-white\\"},Me=["disabled"],Be={key:0,class:"animate-spin"},Fe={key:0,class:"mt-4 p-4 bg-red-100 dark:bg-red-900 border border-red-400 dark:border-red-700 text-red-700 dark:text-red-200 rounded-lg"},$e={__name:"bulk-create",setup(je){z();const P=u([]),S=u([]),n=u([]),c=u(""),k=u(""),y=u(""),f=u(!1),b=u(!1),m=u(""),o=u({customerId:null,customerName:"",paymentMethod:"CASH",paymentStatus:"PAID",amountPaid:0,notes:""}),w=r=>new Intl.NumberFormat("en-US",{minimumFractionDigits:2,maximumFractionDigits:2}).format(r||0),L=x(()=>P.value.filter(r=>r.currentStock>0&&!n.value.some(e=>e.productId===r.id))),D=x(()=>{const r=y.value.toLowerCase();return L.value.filter(e=>e.itemName.toLowerCase().includes(r)||e.barcodeNumber&&e.barcodeNumber.toLowerCase().includes(r))}),q=x(()=>n.value.reduce((r,e)=>r+(e.quantity||0),0)),g=x(()=>n.value.reduce((r,e)=>r+(e.quantity||0)*(e.unitPrice||0),0)),U=x(()=>n.value.length>0&&o.value.customerName.trim()!==""&&g.value>0);G(g,r=>{o.value.amountPaid===0&&(o.value.amountPaid=r)});const M=async()=>{try{const{$api:r}=I(),e=await r.get("/products",{limit:1e3});P.value=e.products||[]}catch(r){m.value="Failed to load products",console.error(r)}},B=async()=>{try{const{$api:r}=I(),e=await r.get("/lenders");S.value=e.lenders||[]}catch(r){console.error("Failed to load lenders:",r)}},F=()=>{if(k.value){const r=S.value.find(e=>e.id===k.value);r&&(o.value.customerId=r.id,o.value.customerName=`${r.name}`.trim())}else o.value.customerId=null,o.value.customerName=""},j=async()=>{try{f.value=!0;const r=P.value.find(e=>e.id===c.value);if(!r){m.value="Product not found";return}n.value.push({productId:r.id,product:r,quantity:1,unitPrice:r.sellingPrice}),c.value="",m.value=""}finally{f.value=!1}},E=r=>{n.value.splice(r,1)},R=()=>{},$=()=>{g.value-o.value.amountPaid<=0?o.value.paymentStatus="PAID":o.value.amountPaid>0?o.value.paymentStatus="PARTIAL":o.value.paymentStatus="UNPAID"},H=async()=>{try{m.value="",b.value=!0;const{$api:r}=I();if(!U.value){m.value="Please fill in all required fields";return}const e=n.value.map(p=>({productId:p.productId,quantity:p.quantity,unitPrice:p.unitPrice,customerId:o.value.customerId,customerName:o.value.customerName,paymentMethod:o.value.paymentMethod,paymentStatus:o.value.paymentStatus,amountPaid:o.value.amountPaid,notes:o.value.notes}));await r.post("/sales/bulk",{sales:e,totalAmount:g.value}),W("/sales")}catch(r){m.value=r.message||"Error creating bulk sale"}finally{b.value=!1}};return O(()=>{M(),B()}),(r,e)=>{const p=Q;return l(),d("div",X,[t("div",Y,[t("div",Z,[t("div",ee,[t("div",te,[e[10]||(e[10]=t("div",null,[t("h1",{class:"text-3xl font-bold text-gray-900 dark:text-white"}," Create Bulk Sale "),t("p",{class:"text-gray-600 dark:text-gray-400 mt-2"}," Select multiple products and create a sale order ")],-1)),J(p,{to:"/sales",class:"inline-flex items-center px-4 py-2 border border-gray-300 dark:border-gray-600 text-sm font-medium rounded-md text-gray-700 dark:text-gray-300 bg-white dark:bg-gray-700 hover:bg-gray-50 dark:hover:bg-gray-600"},{default:K(()=>[...e[9]||(e[9]=[A(" ← Back to Sales ",-1)])]),_:1})])])]),t("div",re,[t("div",ae,[t("div",oe,[e[18]||(e[18]=t("h2",{class:"text-lg font-semibold text-gray-900 dark:text-white mb-4"}," Select Products ",-1)),t("div",de,[e[12]||(e[12]=t("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2"},"Search & Select Product",-1)),t("div",se,[i(t("input",{"onUpdate:modelValue":e[0]||(e[0]=a=>y.value=a),type:"text",placeholder:"Search products...",class:"flex-1 rounded-md border-gray-300 dark:border-gray-600 shadow-sm focus:border-primary-500 focus:ring-primary-500 dark:bg-gray-700 dark:text-white px-3 py-2 border"},null,512),[[v,y.value]]),y.value?(l(),d("button",{key:0,onClick:e[1]||(e[1]=a=>{c.value="",y.value=""}),class:"px-3 py-2 text-gray-600 dark:text-gray-400 hover:text-gray-900 dark:hover:text-white font-medium"}," ✕ ")):C("",!0),t("button",{onClick:j,disabled:!c.value||f.value,class:"px-4 py-2 bg-primary-600 text-white rounded-md hover:bg-primary-700 disabled:opacity-50 disabled:cursor-not-allowed font-medium whitespace-nowrap"},s(f.value?"Adding...":"Add"),9,le)]),D.value.length>0?i((l(),d("select",{key:0,"onUpdate:modelValue":e[2]||(e[2]=a=>c.value=a),size:"5",class:"w-full rounded-md border-gray-300 dark:border-gray-600 shadow-sm focus:border-primary-500 focus:ring-primary-500 dark:bg-gray-700 dark:text-white px-3 py-2 border"},[e[11]||(e[11]=t("option",{value:""},"Choose a product...",-1)),(l(!0),d(N,null,_(D.value,a=>(l(),d("option",{key:a.id,value:a.id},s(a.itemName)+" (Stock: "+s(a.currentStock)+") ",9,ne))),128))],512)),[[h,c.value]]):y.value?(l(),d("div",ue,' No products found matching "'+s(y.value)+'" ',1)):(l(),d("div",ie," Type to search for products "))]),n.value.length>0?(l(),d("div",me,[e[16]||(e[16]=t("h3",{class:"text-md font-semibold text-gray-900 dark:text-white"}," Products in Sale ",-1)),t("div",ye,[(l(!0),d(N,null,_(n.value,(a,V)=>(l(),d("div",{key:V,class:"border border-gray-200 dark:border-gray-600 rounded-lg p-4 bg-white dark:bg-gray-800"},[t("div",ge,[t("div",null,[t("p",ce,s(a.product.itemName),1),t("p",be," Available stock: "+s(a.product.currentStock),1)]),t("button",{onClick:T=>E(V),class:"text-red-600 dark:text-red-400 hover:text-red-900 dark:hover:text-red-300 text-sm font-medium"}," Remove ",8,pe)]),t("div",ve,[t("div",null,[e[13]||(e[13]=t("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-300"},"Quantity",-1)),i(t("input",{"onUpdate:modelValue":T=>a.quantity=T,type:"number",min:"1",max:a.product.currentStock,onChange:R,class:"mt-1 block w-full rounded-md border-gray-300 dark:border-gray-600 shadow-sm focus:border-primary-500 focus:ring-primary-500 dark:bg-gray-700 dark:text-white px-3 py-2 border"},null,40,xe),[[v,a.quantity,void 0,{number:!0}]])]),t("div",null,[e[14]||(e[14]=t("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-300"},"Unit Price",-1)),t("div",ke,s(w(a.unitPrice)),1)]),t("div",null,[e[15]||(e[15]=t("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-300"},"Total",-1)),t("div",fe,s(w(a.quantity*a.unitPrice)),1)])])]))),128))])])):(l(),d("div",we,[...e[17]||(e[17]=[t("p",{class:"text-gray-600 dark:text-gray-400"}," No products selected yet. Add products to create a sale. ",-1)])]))])]),t("div",null,[t("div",he,[e[34]||(e[34]=t("h2",{class:"text-lg font-semibold text-gray-900 dark:text-white mb-4"}," Sale Summary ",-1)),t("div",Pe,[t("div",Se,[e[19]||(e[19]=t("span",null,"Products Count:",-1)),t("span",Ce,s(n.value.length),1)]),t("div",Ne,[e[20]||(e[20]=t("span",null,"Total Quantity:",-1)),t("span",_e,s(q.value),1)]),t("div",Ae,[e[21]||(e[21]=t("span",null,"Total Amount:",-1)),t("span",Ie,s(w(g.value)),1)])]),e[35]||(e[35]=t("hr",{class:"my-6"},null,-1)),t("div",De,[e[33]||(e[33]=t("h3",{class:"font-semibold text-gray-900 dark:text-white"}," Customer Details ",-1)),t("div",null,[e[23]||(e[23]=t("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-300"},"Select Lender (Optional)",-1)),i(t("select",{"onUpdate:modelValue":e[3]||(e[3]=a=>k.value=a),onChange:F,class:"mt-1 block w-full rounded-md border-gray-300 dark:border-gray-600 shadow-sm focus:border-primary-500 focus:ring-primary-500 dark:bg-gray-700 dark:text-white px-3 py-2 border"},[e[22]||(e[22]=t("option",{value:""},"-- Select a Lender --",-1)),(l(!0),d(N,null,_(S.value,a=>(l(),d("option",{key:a.id,value:a.id},s(a.name),9,Ue))),128))],544),[[h,k.value]]),e[24]||(e[24]=t("p",{class:"mt-1 text-xs text-gray-500 dark:text-gray-400"}," Select a lender to auto-populate the customer name, or enter a name manually below. ",-1))]),t("div",null,[e[25]||(e[25]=t("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-300"},"Customer Name",-1)),i(t("input",{"onUpdate:modelValue":e[4]||(e[4]=a=>o.value.customerName=a),type:"text",class:"mt-1 block w-full rounded-md border-gray-300 dark:border-gray-600 shadow-sm focus:border-primary-500 focus:ring-primary-500 dark:bg-gray-700 dark:text-white px-3 py-2 border",placeholder:"Enter customer name",required:""},null,512),[[v,o.value.customerName]])]),t("div",null,[e[27]||(e[27]=t("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-300"},"Payment Method",-1)),i(t("select",{"onUpdate:modelValue":e[5]||(e[5]=a=>o.value.paymentMethod=a),class:"mt-1 block w-full rounded-md border-gray-300 dark:border-gray-600 shadow-sm focus:border-primary-500 focus:ring-primary-500 dark:bg-gray-700 dark:text-white px-3 py-2 border"},[...e[26]||(e[26]=[t("option",{value:"CASH"},"Cash",-1),t("option",{value:"CREDIT"},"Credit",-1),t("option",{value:"CHEQUE"},"Cheque",-1),t("option",{value:"TRANSFER"},"Transfer",-1)])],512),[[h,o.value.paymentMethod]])]),t("div",null,[e[29]||(e[29]=t("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-300"},"Payment Status",-1)),i(t("select",{"onUpdate:modelValue":e[6]||(e[6]=a=>o.value.paymentStatus=a),class:"mt-1 block w-full rounded-md border-gray-300 dark:border-gray-600 shadow-sm focus:border-primary-500 focus:ring-primary-500 dark:bg-gray-700 dark:text-white px-3 py-2 border"},[...e[28]||(e[28]=[t("option",{value:"PAID"},"Paid",-1),t("option",{value:"PARTIAL"},"Partial",-1),t("option",{value:"UNPAID"},"Unpaid",-1)])],512),[[h,o.value.paymentStatus]])]),t("div",null,[e[30]||(e[30]=t("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-300"},"Amount Paid",-1)),i(t("input",{"onUpdate:modelValue":e[7]||(e[7]=a=>o.value.amountPaid=a),type:"number",step:"0.01",min:"0",max:g.value,onChange:$,class:"mt-1 block w-full rounded-md border-gray-300 dark:border-gray-600 shadow-sm focus:border-primary-500 focus:ring-primary-500 dark:bg-gray-700 dark:text-white px-3 py-2 border"},null,40,Ve),[[v,o.value.amountPaid,void 0,{number:!0}]])]),t("div",Te,[t("p",Le,[e[31]||(e[31]=A(" Amount Due: ",-1)),t("span",qe,s(w(g.value-o.value.amountPaid)),1)])]),t("div",null,[e[32]||(e[32]=t("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-300"},"Notes",-1)),i(t("textarea",{"onUpdate:modelValue":e[8]||(e[8]=a=>o.value.notes=a),class:"mt-1 block w-full rounded-md border-gray-300 dark:border-gray-600 shadow-sm focus:border-primary-500 focus:ring-primary-500 dark:bg-gray-700 dark:text-white px-3 py-2 border",rows:"3",placeholder:"Additional notes..."},null,512),[[v,o.value.notes]])])])]),t("button",{onClick:H,disabled:!U.value||b.value,class:"w-full px-4 py-3 bg-primary-600 dark:bg-primary-700 text-white rounded-lg hover:bg-primary-700 dark:hover:bg-primary-600 disabled:opacity-50 disabled:cursor-not-allowed font-semibold flex items-center justify-center gap-2"},[b.value?(l(),d("span",Be,[...e[36]||(e[36]=[t("svg",{class:"h-5 w-5",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24"},[t("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"}),t("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})],-1)])])):C("",!0),A(" "+s(b.value?"Creating Sale...":"Create Bulk Sale"),1)],8,Me),m.value?(l(),d("div",Fe,s(m.value),1)):C("",!0)])])])])}}};export{$e as default};

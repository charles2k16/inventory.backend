import{_ as st}from"./jNmtiVgl.js";import{o as c,c as y,F as W,r as q,a as t,t as l,n as z,x as M,G as V,k as rt,b as P,w as nt,s as $,l as s,d as E,m as B,v as ot,y as lt,j as H,g as m,A as C,C as dt}from"./D8_npMnH.js";import{_ as ut}from"./2HMNWRjp.js";const it={class:"flex gap-2 mb-6 flex-wrap"},mt=["onClick"],gt={__name:"DateRangeSelector",props:{modelValue:{type:String,default:"today"}},emits:["update:range"],setup(h){const b=[{label:"Today",value:"today"},{label:"This Week",value:"week"},{label:"This Month",value:"month"},{label:"All Time",value:"all"}];return(u,g)=>(c(),y("div",it,[(c(),y(W,null,q(b,r=>t("button",{key:r.value,onClick:n=>u.$emit("update:range",r.value),class:z(["px-4 py-2 rounded-md font-medium text-sm transition",h.modelValue===r.value?"bg-primary-600 text-white":"bg-gray-200 text-gray-700 hover:bg-gray-300"])},l(r.label),11,mt)),64))]))}},pt={class:"bg-white dark:bg-gray-800 shadow rounded-lg p-6 mb-6"},ct={class:"grid grid-cols-1 md:grid-cols-3 gap-4"},yt=["value"],xt=["value"],bt={__name:"SalesFilters",props:{search:{type:String,default:""},paymentStatus:{type:String,default:""}},emits:["update:search","update:paymentStatus","clear"],setup(h,{emit:b}){const u=b,g=()=>{u("update:search",""),u("update:paymentStatus",""),u("clear")};return(r,n)=>(c(),y("div",pt,[n[5]||(n[5]=t("h3",{class:"text-lg font-medium text-gray-900 dark:text-white mb-4"},"Filters",-1)),t("div",ct,[t("div",null,[n[2]||(n[2]=t("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1"},"Customer",-1)),t("input",{value:h.search,onInput:n[0]||(n[0]=o=>r.$emit("update:search",o.target.value)),type:"text",placeholder:"Search customer...",class:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-white rounded-md focus:outline-none focus:ring-primary-500 focus:border-primary-500"},null,40,yt)]),t("div",null,[n[4]||(n[4]=t("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1"},"Payment Status",-1)),t("select",{value:h.paymentStatus,onChange:n[1]||(n[1]=o=>r.$emit("update:paymentStatus",o.target.value)),class:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-white rounded-md focus:outline-none focus:ring-primary-500 focus:border-primary-500"},[...n[3]||(n[3]=[t("option",{value:""},"All Statuses",-1),t("option",{value:"PAID"},"Paid",-1),t("option",{value:"UNPAID"},"Unpaid",-1),t("option",{value:"PARTIAL"},"Partial",-1)])],40,xt)]),t("div",{class:"flex items-end"},[t("button",{onClick:g,class:"w-full px-4 py-2 bg-gray-200 dark:bg-gray-700 text-gray-700 dark:text-gray-300 rounded-md hover:bg-gray-300 dark:hover:bg-gray-600 font-medium"}," Clear Filters ")])])]))}},vt={class:"overflow-x-auto"},ht={class:"min-w-full divide-y divide-gray-200 dark:divide-gray-700"},ft={class:"bg-white dark:bg-gray-800 divide-y divide-gray-200 dark:divide-gray-700"},kt={key:0},wt={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-900 dark:text-white"},St={class:"px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900 dark:text-white"},_t={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-500 dark:text-gray-400"},Dt={class:"px-6 py-4 whitespace-nowrap text-sm font-semibold text-gray-900 dark:text-white"},At={class:"px-6 py-4 whitespace-nowrap"},Ct={class:"px-6 py-4 whitespace-nowrap text-sm font-medium"},Pt=["onClick"],$t=["onClick"],It={__name:"SalesTable",props:{sales:{type:Array,default:()=>[]}},emits:["view","update-payment"],setup(h){const b=r=>{const n=new Date(r);return new Intl.DateTimeFormat("en-US",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}).format(n)},u=r=>new Intl.NumberFormat("en-US",{minimumFractionDigits:2,maximumFractionDigits:2}).format(r||0),g=r=>({PAID:"bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-200",UNPAID:"bg-red-100 text-red-800 dark:bg-red-900 dark:text-red-200",PARTIAL:"bg-yellow-100 text-yellow-800 dark:bg-yellow-900 dark:text-yellow-200"})[r]||"bg-gray-100 text-gray-800 dark:bg-gray-700 dark:text-gray-200";return(r,n)=>(c(),y("div",vt,[t("table",ht,[n[1]||(n[1]=t("thead",{class:"bg-gray-50 dark:bg-gray-700"},[t("tr",null,[t("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider"}," Date "),t("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider"}," Customer "),t("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider"}," Items "),t("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider"}," Amount "),t("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider"}," Payment Status "),t("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider"}," Action ")])],-1)),t("tbody",ft,[h.sales.length===0?(c(),y("tr",kt,[...n[0]||(n[0]=[t("td",{colspan:"6",class:"px-6 py-4 text-center text-gray-500 dark:text-gray-400"}," No sales found ",-1)])])):M("",!0),(c(!0),y(W,null,q(h.sales,o=>(c(),y("tr",{key:o.id,class:"hover:bg-gray-50 dark:hover:bg-gray-700"},[t("td",wt,l(b(o.createdAt)),1),t("td",St,l(o.lenderName||o.customerName||"Walk-in"),1),t("td",_t,l(o.items?.length||0),1),t("td",Dt," GHS "+l(u(o.totalAmount)),1),t("td",At,[t("span",{class:z(["px-3 py-1 inline-flex text-xs leading-5 font-semibold rounded-full",g(o.paymentStatus)])},l(o.paymentStatus),3)]),t("td",Ct,[t("button",{onClick:f=>r.$emit("view",o),class:"text-primary-600 dark:text-primary-400 hover:text-primary-900 dark:hover:text-primary-300 mr-4"}," View ",8,Pt),o.paymentStatus!=="PAID"?(c(),y("button",{key:0,onClick:f=>r.$emit("update-payment",o),class:"text-blue-600 dark:text-blue-400 hover:text-blue-900 dark:hover:text-blue-300"}," Update Payment ",8,$t)):M("",!0)])]))),128))])])]))}},Tt={class:"bg-white dark:bg-gray-800 shadow"},Nt={class:"max-w-7xl mx-auto py-6 px-4 sm:px-6 lg:px-8 flex justify-between items-center"},Ut={class:"flex gap-3"},Ft={class:"max-w-7xl mx-auto py-6 sm:px-6 lg:px-8"},Mt={class:"grid grid-cols-1 md:grid-cols-3 gap-6 mb-6"},Rt={class:"bg-white dark:bg-gray-800 p-6 rounded-lg shadow"},Lt={class:"text-sm font-medium text-gray-500 dark:text-gray-400"},Vt={class:"text-2xl font-bold text-gray-900 dark:text-white mt-2"},Et={class:"text-xs text-gray-500 dark:text-gray-400 mt-1"},Ht={class:"bg-white dark:bg-gray-800 p-6 rounded-lg shadow"},Gt={class:"text-2xl font-bold text-gray-900 dark:text-white mt-2"},jt={class:"text-xs text-gray-500 dark:text-gray-400 mt-1"},Ot={class:"bg-white dark:bg-gray-800 p-6 rounded-lg shadow"},Bt={class:"text-2xl font-bold text-red-600 dark:text-red-400 mt-2"},Wt={class:"text-xs text-gray-500 dark:text-gray-400 mt-1"},qt={class:"bg-white dark:bg-gray-800 shadow rounded-lg"},zt={key:0,class:"fixed inset-0 bg-gray-500 bg-opacity-75 flex items-center justify-center z-50 p-4"},Yt={class:"bg-white dark:bg-gray-800 rounded-lg shadow-lg max-w-md w-full"},Qt={class:"px-6 py-4 space-y-4"},Jt={class:"text-sm text-gray-700 dark:text-gray-300"},Kt={class:"font-medium"},Xt={class:"mt-1"},Zt={class:"font-semibold"},te={class:"font-semibold"},ee=["max"],ae={key:0,class:"text-sm text-red-600 dark:text-red-400"},se={class:"px-6 py-4 border-t border-gray-200 dark:border-gray-700 flex gap-3 justify-end"},re=["disabled"],G=50,de={__name:"index",setup(h){const b=m([]),u=m(""),g=m(""),r=m("today"),n=m(!1),o=m(1),f=m({total:0,pages:1}),w=m({totalSales:0,salesCount:0,totalItems:0,pendingAmount:0,pendingCount:0}),I=a=>new Intl.NumberFormat("en-US",{minimumFractionDigits:2,maximumFractionDigits:2}).format(a||0),j=C(()=>({today:"Today",week:"This Week",month:"This Month",all:"All Time"})[r.value]||"Today"),O=()=>{const a=new Date,e=new Date(a.getFullYear(),a.getMonth(),a.getDate());switch(r.value){case"today":return{start:e,end:new Date(e.getTime()+1440*60*1e3)};case"week":{const d=new Date(e);return d.setDate(e.getDate()-e.getDay()),{start:d,end:new Date}}case"month":return{start:new Date(a.getFullYear(),a.getMonth(),1),end:new Date};case"all":return{start:new Date("2000-01-01"),end:new Date};default:return{start:e,end:new Date(e.getTime()+1440*60*1e3)}}},Y=C(()=>f.value.pages||1),Q=C(()=>f.value.total?(o.value-1)*G:0),J=C(()=>f.value.total?Math.min(o.value*G,f.value.total):0),K=C(()=>f.value.total||0),T=C(()=>b.value.filter(a=>{const e=!u.value||a.lenderName&&a.lenderName.toLowerCase().includes(u.value.toLowerCase())||a.customerName&&a.customerName.toLowerCase().includes(u.value.toLowerCase()),d=!g.value||a.paymentStatus===g.value;return e&&d})),X=()=>{const a=T.value;w.value={totalSales:a.reduce((e,d)=>e+(d.totalAmount||0),0),salesCount:a.length,totalItems:a.reduce((e,d)=>e+(d.items?.reduce((S,_)=>S+(_.quantity||0),0)||0),0),pendingAmount:a.filter(e=>e.paymentStatus==="UNPAID"||e.paymentStatus==="PARTIAL").reduce((e,d)=>e+(d.amountDue||0),0),pendingCount:a.filter(e=>e.paymentStatus==="UNPAID"||e.paymentStatus==="PARTIAL").length}},N=async()=>{try{n.value=!0;const{$api:a}=H(),{start:e,end:d}=O(),S=e.toISOString().split("T")[0],_=d.toISOString().split("T")[0],v=await a.get("/sales/summary",{startDate:S,endDate:_});w.value={totalSales:v.totalRevenue||0,salesCount:v.totalSales||0,totalItems:v.totalItems||0,pendingAmount:v.pendingPayments||0,pendingCount:T.value.filter(D=>D.paymentStatus==="UNPAID"||D.paymentStatus==="PARTIAL").length}}catch(a){console.error("Error fetching summary stats:",a),X()}finally{n.value=!1}};V(r,()=>{U(),N()}),V(T,()=>{N()});const U=async()=>{try{const{$api:a}=H(),{start:e,end:d}=O(),S=e.toISOString().split("T")[0],_=d.toISOString().split("T")[0],v={startDate:S,endDate:_,page:o.value,limit:G};g.value&&(v.status=g.value);const D=await a.get("/sales",v);b.value=D.sales||[],f.value=D.pagination||{total:b.value.length,pages:1}}catch(a){console.error("Error fetching sales:",a)}},Z=()=>{u.value="",g.value=""},tt=a=>{dt(`/sales/${a.id}`)},R=m(!1),i=m(null),x=m(0),A=m("CASH"),F=m(!1),k=m(""),et=a=>{i.value=a;const e=a.amountDue!=null?a.amountDue:(a.totalAmount||0)-(a.amountPaid||0);x.value=Math.max(0,e),A.value=a.paymentMethod||"CASH",k.value="",R.value=!0},L=()=>{R.value=!1,i.value=null,x.value=0,A.value="CASH",k.value=""},at=async()=>{if(!i.value)return;if(!x.value||x.value<=0){k.value="Please enter an amount greater than 0";return}const a=i.value.amountDue!=null?i.value.amountDue:(i.value.totalAmount||0)-(i.value.amountPaid||0);if(x.value>a){k.value="Amount cannot be greater than amount due";return}try{F.value=!0,k.value="";const{$api:e}=H();await e.patch(`/sales/${i.value.id}/payment`,{amountPaid:x.value,paymentMethod:A.value}),L(),await U(),await N()}catch(e){console.error("Error updating payment:",e),k.value=e.message||"Error updating payment"}finally{F.value=!1}};return V(o,()=>{U()}),rt(()=>{U(),N()}),(a,e)=>{const d=st,S=gt,_=bt,v=It,D=ut;return c(),y("div",null,[t("header",Tt,[t("div",Nt,[e[8]||(e[8]=t("h1",{class:"text-3xl font-bold text-gray-900 dark:text-white"},"Sales",-1)),t("div",Ut,[P(d,{to:"/sales/bulk-create",class:"inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md text-white bg-blue-600 hover:bg-blue-700"},{default:nt(()=>[...e[7]||(e[7]=[E(" + Bulk Sale ",-1)])]),_:1})])])]),t("main",Ft,[P(S,{modelValue:s(r),"onUpdate:modelValue":e[0]||(e[0]=p=>$(r)?r.value=p:null),"onUpdate:range":e[1]||(e[1]=p=>r.value=p)},null,8,["modelValue"]),t("div",Mt,[t("div",Rt,[t("h3",Lt,l(s(j))+"'s Sales ",1),t("p",Vt," GHS "+l(I(s(w).totalSales)),1),t("p",Et,l(s(w).salesCount)+" sales ",1)]),t("div",Ht,[e[9]||(e[9]=t("h3",{class:"text-sm font-medium text-gray-500 dark:text-gray-400"},"Items Sold",-1)),t("p",Gt,l(s(w).totalItems),1),t("p",jt,l(s(j)),1)]),t("div",Ot,[e[10]||(e[10]=t("h3",{class:"text-sm font-medium text-gray-500 dark:text-gray-400"}," Pending Payments ",-1)),t("p",Bt," GHS "+l(I(s(w).pendingAmount)),1),t("p",Wt,l(s(w).pendingCount)+" sales ",1)])]),P(_,{search:s(u),"onUpdate:search":e[2]||(e[2]=p=>$(u)?u.value=p:null),paymentStatus:s(g),"onUpdate:paymentStatus":e[3]||(e[3]=p=>$(g)?g.value=p:null),onClear:Z},null,8,["search","paymentStatus"]),t("div",qt,[e[11]||(e[11]=t("div",{class:"px-4 py-5 sm:px-6 border-b border-gray-200 dark:border-gray-700"},[t("h3",{class:"text-lg leading-6 font-medium text-gray-900 dark:text-white"}," Sales ")],-1)),P(v,{sales:s(T),onView:tt,onUpdatePayment:et},null,8,["sales"]),P(D,{"current-page":s(o),"total-pages":s(Y),"start-index":s(Q),"end-index":s(J),"total-items":s(K),"onUpdate:page":e[4]||(e[4]=p=>o.value=p)},null,8,["current-page","total-pages","start-index","end-index","total-items"])]),s(R)&&s(i)?(c(),y("div",zt,[t("div",Yt,[t("div",{class:"px-6 py-4 border-b border-gray-200 dark:border-gray-700 flex justify-between items-center"},[e[12]||(e[12]=t("h3",{class:"text-lg font-medium text-gray-900 dark:text-white"}," Update Payment ",-1)),t("button",{onClick:L,class:"text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200"}," âœ• ")]),t("div",Qt,[t("div",Jt,[t("p",Kt,l(s(i).lenderName||s(i).customerName||"Walk-in"),1),t("p",Xt,[e[13]||(e[13]=E(" Total: ",-1)),t("span",Zt," GHS "+l(I(s(i).totalAmount)),1)]),t("p",null,[e[14]||(e[14]=E(" Amount Due: ",-1)),t("span",te," GHS "+l(I(s(i).amountDue)),1)])]),t("div",null,[e[15]||(e[15]=t("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1"}," Amount to pay now ",-1)),B(t("input",{"onUpdate:modelValue":e[5]||(e[5]=p=>$(x)?x.value=p:null),type:"number",min:"0",max:s(i).amountDue,class:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-white rounded-md focus:outline-none focus:ring-primary-500 focus:border-primary-500"},null,8,ee),[[ot,s(x),void 0,{number:!0}]])]),t("div",null,[e[17]||(e[17]=t("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1"}," Payment Method ",-1)),B(t("select",{"onUpdate:modelValue":e[6]||(e[6]=p=>$(A)?A.value=p:null),class:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-white rounded-md focus:outline-none focus:ring-primary-500 focus:border-primary-500"},[...e[16]||(e[16]=[t("option",{value:"CASH"},"Cash",-1),t("option",{value:"CREDIT"},"Credit",-1),t("option",{value:"CHEQUE"},"Cheque",-1),t("option",{value:"TRANSFER"},"Transfer",-1)])],512),[[lt,s(A)]])]),s(k)?(c(),y("p",ae,l(s(k)),1)):M("",!0)]),t("div",se,[t("button",{onClick:L,class:"px-4 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-md hover:bg-gray-50"}," Cancel "),t("button",{onClick:at,disabled:s(F)||s(x)<=0,class:"px-4 py-2 text-sm font-medium text-white bg-primary-600 border border-transparent rounded-md hover:bg-primary-700 disabled:opacity-50 disabled:cursor-not-allowed"},l(s(F)?"Saving...":"Save Payment"),9,re)])])])):M("",!0)])])}}};export{de as default};
